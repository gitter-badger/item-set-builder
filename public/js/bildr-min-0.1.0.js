var global={setName:"Unnamed_Item_Set",selectedMap:"",selectedMode:"",selectedChamp:""};
$(document).ready(function(){$("#item-set-add-block-button").click(function(){createItemBlock("New Item Block",[],[]);$(".collapsible").collapsible({accordion:!1});$(this).parent().find(".item-block-name").last().click()});$(document).on("click",".edit-item-block-button",function(){var a=$(this).parent().parent().find(".item-block-name");a.attr("contentEditable",!0);a.focus();a.select()});$(document).on("click",".toggle-item-block-button",function(){$(this).parent().parent().find(".item-block-name").click()});
$(document).on("click",".close-item-block-button",function(){var a=$(this).parent().parent();a.slideUp("500");setTimeout(function(){a.remove()},500)});$(document).on("focusout",".item-block-name",function(){$(this).attr("contentEditable",!1)});$(this).find(".item-block-name").last().click()});
$(document).ready(function(){null!=localStorage.getItem("itemSetBuilderData")&&""!=localStorage.getItem("itemSetBuilderData")&&loadSessionData();$("#reset-button").click(function(){resetItemBlocks();resetSetInfo();$("#item-search-box").val("");$("input[type=checkbox]").each(function(){$(this).prop("checked",!1)});$(".item",$("#all-items")).show()});$("#upload-button").click(function(){$("#hidden-upload-button").click()});$("#download-button").click(function(){createJSONFile();$("#download-instructions-box").openModal();
var a="Unnamed Item Set.json";global.setName&&(a=global.setName+".json");global.selectedChamp?($("#champ-set-instructions").show(),$("#global-set-instructions").hide(),$("#champKey").text(global.selectedChamp)):($("#global-set-instructions").show(),$("#champ-set-instructions").hide());$(".fileName").text(a)});$("#set-form-name").on("input",function(){global.setName=$("#set-form-name").val();$("#download-button").attr("download",global.setName+".json")});$("#save-button").click(function(){saveSessionData()});
$("#about-button").click(function(){$("#help-about-box").openModal()})});function handleFileUpload(a){a=a[0];var b=new FileReader;b.onload=function(a){loadFromJSON(JSON.parse(a.target.result))};b.readAsText(a)}function saveSessionData(){var a=createJSONObject();localStorage.setItem("itemSetBuilderData",JSON.stringify(a))}function loadSessionData(){var a=JSON.parse(localStorage.getItem("itemSetBuilderData"));loadFromJSON(a)}
function clearSessionData(){localStorage.removeItem("itemSetBuilderData")}function resetItemBlocks(){removeItemBlocks();createItemBlock("New Item Block",[],[])}function resetSetInfo(){$("#set-form-name").val("");global.setName="Unnamed_Item_Set";$(".map-selected").removeClass("map-selected");global.selectedMap="";global.selectedMode="";$(".champ-selected").removeClass("map-selected");global.selectedChamp=""}function removeItemBlocks(){$("#item-set-blocks").empty()}
function createItemBlock(a,b,e){var c=0,d='<li><div class="item-block-buttons noselect"><i class="material-icons toggle-item-block-button text-grey text-darken-2">swap_vert</i><i class="material-icons edit-item-block-button">spellcheck</i></div><div class="item-block-close-button noselect"><i class="material-icons close-item-block-button text-grey text-darken-2">clear</i></div>',d=d.concat('<div class="collapsible-header grey-text text-darken-2"><span class="item-block-name">'+a+"</span></div>"),
d=d.concat('<div class="collapsible-body grey lighten-3 grey-text text-darken-2"><div class="item-slots clearfix">');for(b.forEach(function(a,b){c++;d=d.concat('<div class="item-slot slot-'+c+'" ondrop="drop(event)" ondragover="allowDrop(event)"><div class="item-count count-'+c+'">'+e[b]+'</div><img class="item" draggable="true" id="'+a+'" ondragstart="drag(event)" src="/images/items/'+a+'.png"></div>')});10>c;)c++,d=d.concat('<div class="item-slot slot-'+c+'" ondrop="drop(event)" ondragover="allowDrop(event)"><div class="item-count count-'+
c+'">1</div></div>');d=d.concat("</div></div></li>");$("#item-set-blocks").append(d);$(".collapsible").collapsible({accordion:!1});$(".item-count").filter(function(){return 1<Number($(this).text())}).show()}
function loadFromJSON(a){var b,e=[],c=[];removeItemBlocks();global={setName:a.title,selectedMap:a.map,selectedMode:a.mode,selectedChamp:""};$("#set-form-name").val(global.setName);$('*[data-map="'+global.selectedMap+'"]').addClass("map-selected");a.blocks.forEach(function(a){b=a.type;e=[];c=[];a.items.forEach(function(a){e.push(a.id);c.push(a.count)});createItemBlock(b,e,c)})}
function createJSONFile(){var a=createJSONObject();data="text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a));$("#download-button").attr("href","data:"+data);global.setName?$("#download-button").attr("download",global.setName+".json"):$("#download-button").attr("download","Unnamed Item Set.json")}
function createJSONObject(){var a={title:global.setName,type:"custom",map:""==global.selectedMap?"any":global.selectedMap,mode:""==global.selectedMode?"any":global.selectedMode,priority:!1,sortrank:0,blocks:[]};$.each($("#item-set-blocks li"),function(b){var e={items:[],type:$("#item-set-blocks li").find(".item-block-name")[b].textContent};$.each($($("#item-set-blocks li")[b]).find("img"),function(a){e.items.push({id:$($($("#item-set-blocks li")[b]).find("img")[a]).attr("id"),count:$($("#item-set-blocks li")[b]).find(".count-"+
$($($("#item-set-blocks li")[b]).find("img")[a]).parent().attr("class").match(/slot-(\d+)/)[1]).text()})});a.blocks.push(e)});return a}function allowDrop(a){a.preventDefault()}function drag(a){a.dataTransfer.setData("text",a.target.id);a.dataTransfer.setData("parent",a.target.parentElement.className);a.target.parentElement.className.indexOf("item-slots")&&a.dataTransfer.setData("index",$(a.target.parentElement).parent().children().index($(a.target.parentElement)))}
function drop(a){a.preventDefault();var b=a.dataTransfer.getData("text"),e=0==$(a.target.parentElement).not(".item-slot").length,c,d,g=10;e?(c=$(a.target.parentElement).parent().children(),d=c.index(a.target.parentElement)):(c=$(a.target.parentElement).children(),d=c.index(a.target));c.each(function(){if(0==$(this).find("img").length)return g=$(this).parent().children().index($(this)),!1});if(-1<a.dataTransfer.getData("parent").indexOf("item-slot")){var h=Number(a.dataTransfer.getData("index"));if(e)if(h>
d)if(a.target.id==b){if("2003"==b||"2004"==b||"2043"==b||"2044"==b){var e=$(a.target).parent().find(".item-count"),f=Number($(a.target).parent().find(".item-count").html());"2003"==b&&5>f||"2004"==b&&5>f||"2043"==b&&2>f||"2044"==b&&3>f?($(e).html(++f),$(e).show(),scootRight(a,b,h,g-1,c),c.eq(g-1).remove()):scootRight(a,b,d,h,c)}}else scootLeft(a,b,d,h,c);else if(a.target.id==b){if("2003"==b||"2004"==b||"2043"==b||"2044"==b)e=$(a.target).parent().find(".item-count"),f=Number($(a.target).parent().find(".item-count").html()),
"2003"==b&&5>f||"2004"==b&&5>f||"2043"==b&&2>f||"2044"==b&&3>f?($(e).html(++f),$(e).show(),scootRight(a,b,h,g-1,c),c.eq(g-1).remove()):scootLeft(a,b,h,d,c)}else scootRight(a,b,h,d,c);else scootRight(a,b,h,g-1,c)}else e?a.target.id==b?(e=$(a.target).parent().find(".item-count"),f=Number($(a.target).parent().find(".item-count").html()),"2003"==b&&5>f||"2004"==b&&5>f||"2043"==b&&2>f||"2044"==b&&3>f?($(e).html(++f),$(e).show()):isFull()||(c.eq(g).append(document.getElementById(b).cloneNode(!0)),scootLeft(a,
b,d,g,c))):isFull()||(c.eq(g).append(document.getElementById(b).cloneNode(!0)),scootLeft(a,b,d,g,c)):c.eq(g).append(document.getElementById(b).cloneNode(!0))}
function scootLeft(a,b,e,c,d){for(a=c-1;a>=e;a--){b=$(d.eq(a).find(".item-count"));var g=Number(d.eq(a).find(".item-count").html());c=$(d.eq(a+1).find(".item-count"));var h=Number(d.eq(a+1).find(".item-count").html());$(b).html(h);$(c).html(g);h=$(b).is(":hidden");g=$(c).is(":hidden");h?c.hide():c.show();g?b.hide():b.show();b=d.eq(a).find(".item").detach();c=d.eq(a+1).find(".item").detach();d.eq(a).append(c);d.eq(a+1).append(b)}}
function scootRight(a,b,e,c,d){for(a=e;a<c;a++){b=$(d.eq(a+1).find(".item-count"));var g=Number(d.eq(a+1).find(".item-count").html());e=$(d.eq(a).find(".item-count"));var h=Number(d.eq(a).find(".item-count").html());$(b).html(h);$(e).html(g);h=$(b).is(":hidden");g=$(e).is(":hidden");h?e.hide():e.show();g?b.hide():b.show();b=d.eq(a).find(".item").detach();e=d.eq(a+1).find(".item").detach();d.eq(a).append(e);d.eq(a+1).append(b)}}
function isFull(){var a=!0;$(".item-slots").children().each(function(){if(0==$(this).find("img").length)return a=!1});return a}
$(document).ready(function(){Opentip.styles.leagueItems={"extends":"alert",borderColor:"rgb(182, 234, 187)",borderWidth:1,background:[[0,"rgba(30, 30, 30, 0.9)"]],borderRadius:5,offset:[0,0],tipJoint:"bottom left",stem:!1};Opentip.defaultStyle="leagueItems";$(".button-collapse").sideNav();$(".filter-menu").draggable({handle:".filter-form-title",containment:"#builder"});$(".filter-items-button").click(function(){toggleFilterMenu()});new Opentip("#champ-help-tooltip","Pick one specific champion or none for a global item set");
new Opentip("#map-help-tooltip","Pick one specific map or none for a global item set");$.get("/getItems",function(a){dataJSON=JSON.parse(a);for(var b in dataJSON)if(dataJSON.hasOwnProperty(b)){$("#all-items").append('<img draggable="true" ondragstart="drag(event)" id="'+b+'" class="item" src="/images/items/'+b+'.png" alt="'+dataJSON[b].name+'"/>');var e="<img src='/images/gold.png'>&nbsp;"+dataJSON[b].gold.total+"<br><br>"+dataJSON[b].description;null!=dataJSON[b].efficiency&&(dataJSON[b].efficiency.base?
(e=e.concat("<br><hr>"),e=e.concat("<b>Case: Base Item</b><br>"),e=e.concat("Gold Efficiency Ratio: <b class='item-efficiency-neutral'>100%</b><br><br>")):(e=e.concat("<br><hr>"),$.each(dataJSON[b].efficiency.cases,function(a,b){var g=Object.keys(b)[0],h=b[g]["Gold Efficiency Ratio"],f=parseFloat(b[g]["Gold Efficiency Ratio"]),f=100<f?"item-efficiency-positive":100>f?"item-efficiency-negative":"item-efficiency-neutral";e=e.concat("<b>Case: "+g+"</b><br>");e=e.concat("Gold Efficiency Ratio: <b class="+
f+">"+h+"</b><br><br>")})));new Opentip("#"+b,e,dataJSON[b].name);dataJSON[b].tags&&dataJSON[b].tags.forEach(function(a){$("#"+b).addClass(a)})}});$.get("/getChamps",function(a){dataJSON=JSON.parse(a);sortedKeys=Object.keys(dataJSON).sort();sortedKeys.forEach(function(a){$(".champ-container").append('<div class="col s1 no-padding"><img class="champ-select" data-champ="'+dataJSON[a].key+'" id="'+dataJSON[a].key+'" src="images/champs/'+dataJSON[a].key+'.png" alt="'+dataJSON[a].name+'"></div>');new Opentip("#"+
dataJSON[a].key,dataJSON[a].name)})});$(document).on("click",".map-select",function(){""==global.selectedMap?(global.selectedMap=$(this).data("map"),global.selectedMode=$(this).data("mode"),$(this).addClass("map-selected")):global.selectedMap==$(this).data("map")?($('*[data-map="'+global.selectedMap+'"]').removeClass("map-selected"),global.selectedMap="",global.selectedMode=""):($('*[data-map="'+global.selectedMap+'"]').removeClass("map-selected"),global.selectedMap=$(this).data("map"),global.selectedMode=
$(this).data("mode"),$(this).addClass("map-selected"))});$(document).on("click",".champ-select",function(){""==global.selectedChamp?(global.selectedChamp=$(this).data("champ"),$(this).addClass("champ-selected")):global.selectedChamp==$(this).data("champ")?($('*[data-champ="'+global.selectedChamp+'"]').removeClass("champ-selected"),global.selectedChamp=""):($('*[data-champ="'+global.selectedChamp+'"]').removeClass("champ-selected"),global.selectedChamp=$(this).data("champ"),$(this).addClass("champ-selected"))});
$("#item-search-box").on("input",function(){$("input[type=checkbox]").each(function(){$(this).prop("checked",!1)});var a="jungle lane consumable goldper trinket vision armor health healthregen spellblock attackspeed criticalStrike damage lifesteal cooldownreduction mana manaregen spelldamage boots nonbootsmovement".split(" "),b={tools:["consumable","goldper","trinket vision"],defense:["armor","health","healthregen","spellblock"],attack:["attackspeed","criticalstrike","damage","lifesteal"],magic:["cooldownreduction",
"mana","manaregen","spelldamage"],movement:["boots","nonbootsmovement"]},e={ap:"spelldamage",ad:"damage",as:"attackspeed","attack speed":"attackspeed",mr:"spellblock",hp:"health",cdr:"cooldownreduction"},c=$("#item-search-box").val().toLowerCase(),d=$(".item",$("#all-items"));""!=c?(d.hide(),d.filter(function(){var d=!1,h=-1<this.alt.toLowerCase().indexOf(c),f=this.className.toLowerCase();-1<a.indexOf(c)?(h=!1,d=-1<f.indexOf(" "+c)):b[c]?(h=!1,$.each(b[c],function(a,b){if(-1<f.indexOf(" "+b))return d=
!0,!1})):e[c]&&(h=!1,-1<f.indexOf(" "+e[c])&&(d=!0));return h||d}).show()):d.show()});$("input[type=checkbox]").change(function(){var a=$(".item",$("#all-items"));$("#item-search-box").val()&&($("#item-search-box").val(""),a.show());this.checked||a.show();var b=[];$("input[type=checkbox]").each(function(){this.checked&&b.push(this.id)});var e=!1;a.filter(function(){if(e)return $("input[type=checkbox]").each(function(){$(this).prop("checked",!1)}),a.show(),!1;if(this.hidden)return!1;var c=$(this),
d=!1;b.forEach(function(a){if(e||"All Items"==a)return e=!0,d=!1;if("Starting Items"==a){if(!c.hasClass("Jungle")&&!c.hasClass("Lane"))return d=!0,!1}else if("Tools"==a){if(!c.hasClass("Consumable")&&!c.hasClass("GoldPer")&&!c.hasClass("Trinket Vision"))return d=!0,!1}else if("Defense"==a){if(!(c.hasClass("Armor")||c.hasClass("Health")||c.hasClass("HealthRegen")||c.hasClass("SpellBlock")))return d=!0,!1}else if("Attack"==a){if(!(c.hasClass("AttackSpeed")||c.hasClass("CriticalStrike")||c.hasClass("Damage")||
c.hasClass("LifeSteal")))return d=!0,!1}else if("Magic"==a){if(!(c.hasClass("CooldownReduction")||c.hasClass("Mana")||c.hasClass("ManaRegen")||c.hasClass("SpellDamage")))return d=!0,!1}else if("Movement"==a){if(!c.hasClass("Boots")&&!c.hasClass("NonbootsMovement"))return d=!0,!1}else if(!c.hasClass(a))return d=!0,!1});return d}).hide()})});function toggleFilterMenu(){$(".filter-menu").is(":visible")?$(".filter-menu").fadeOut("fast"):$(".filter-menu").fadeIn("fast")};
